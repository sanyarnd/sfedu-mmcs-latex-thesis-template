% !TEX root = ../diploma.tex

\section{Имя раздела работы}

\subsection{Цитирование и ссылки}
Делать ссылки к библиографии несложно: достаточно поставить \texttt{\\cite\{ссылка\}}. Ссылки не пишутся слитно, поэтому перед \texttt{cite} нужен пробел. Выглядит это примерно так \cite{test}.

Для уравнений можно использовать специальное окружение. Любые окружения (в т.ч. уравнения) можно помечать, чтобы в дальнейшем иметь возможность поставить ссылку. Для этого используется \texttt{label}. Для уравнений есть специальная (совсем не обязательная) версия: \texttt{label\{eq:имя\}} Пример:
\begin{equation}\label{eq:some_eq}
    e^2 = E\{(F - Y)^2\},
\end{equation}
где $E$ -- математическое ожидание.

Чтобы получить ссылку достаточно вставить макрос \texttt{ref\{имя\}}. Для уравнений (в случае использования специальной версии) есть \texttt{eqref}. Получим следующее: \eqref{eq:some_eq}.

\subsection{Списки}

Сущесвует 3 базовых окружения для списков.

Маркированные списки:
\begin{itemize}
    \item пункт 1
    \item пункт 2
\end{itemize}

Нумерованные списки:
\begin{enumerate}
    \item пункт 1
    \item пункт 2
\end{enumerate}

Описания:
\begin{description}
    \item[Пункт] 1
    \item[Пункт] 2
\end{description}

Иногда хочется сжать список. Чтобы не настраивать интервал между списками (это делается не очень удобно) достаточно передать параметр \texttt{[noitemsep]}. 
Этот параметр (а также ряд других, которые можно посмотреть в документации) можно задать глобально после подключения пакета \texttt{enumitem}: \texttt{\backslash setlist[itemize]\{noitemsep, nolistsep\}}.


Без сжатия:
\begin{itemize}
    \item пункт 1
    \item пункт 2
\end{itemize}

Со сжатием:
\begin{itemize}[noitemsep]
    \item пункт 1
    \item пункт 2
\end{itemize}

\subsection{Код и псевдокод}
Вставить код тоже просто. Если настройки листинга не устраивают, их можно изменить. Макрос настройки находится в файле \texttt{commands}.

\begin{lstlisting}[caption={Пример вызова БПФ в библиотеке \texttt{CuFFT}}]
    cufftComplex *d_signal;
    cudaMalloc((void **) &d_signal, mem_size);
    cudaMemcpy(d_signal, fg, mem_size, cudaMemcpyHostToDevice);

    cufftHandle plan;
    cufftPlan2d(&plan, N, N, CUFFT_C2C);

    cufftExecC2C(plan, (cufftComplex *)d_signal, (cufftComplex *)d_signal, CUFFT_FORWARD);
\end{lstlisting}

Также можно писать псевдокод. Ключевые слова можно переводить, вводить новые конструкции и т.д. Пример в файле \texttt{commands}.
\begin{algorithm}[H]
    \caption{Пример псевдокода}
    \begin{algorithmic}[1] % The number tells where the line numbering should start
        \Procedure{F}{$A$, $B$, $N$}
        \State $E \gets A$
        \For{$i := 1$ до $N$}
        \State $\hat{E} = \texttt{fft}~E$
        \EndFor
        \State \textbf{вернуть} $E$
        \EndProcedure
    \end{algorithmic}
\end{algorithm}

\subsection{Таблицы}
Здесь используется вспомогательное окружение \texttt{tabularx} (а также симметричное к нему \texttt{tabulary}), которое управляет шириной столбцов и автоматически переносит текст на новую строку в той же ячейке при нехватке размерности, доступной тексту.

\begin{table}[H]
    \centering
    \begin{tabularx}{\textwidth}{| X | X | X |}
    	\hline
    	\textbf{Размер изображения} & \textbf{Время GPU} & \textbf{Время CPU} \\ \hline
    	$1920\times 1920$           & $6$ мс             & $75$ мс            \\ \hline
    	$4096\times 4096$           & $24$ мс            & $520$ мс           \\ \hline
    	$3648\times 5472$           & $35$ мс            & $625$ мс           \\ \hline
    \end{tabularx}
    \caption{Сравнение скорости работы}
\end{table}

Таблицы как выше просты в использовании, но их внешний вид оставляет желать лучшего. При оформлении работ можно руководствоваться следующим {\href{https://www.inf.ethz.ch/personal/markusp/teaching/guides/guide-tables.pdf}{\textbf{пособием}}.


\begin{table}[H]
    \centering
    \caption{\label{tab:widgets}Подпись к таблице --- сверху}
    \begin{tabular}{llr}
        \toprule
                  \multicolumn{2}{c}{Item}            &  \\
        \cmidrule(r){1-2}
        Животное & Описание & Цена (\$) \\ \midrule
        Armadillo                          & frozen   &      8.99 \\ \bottomrule
    \end{tabular}
\end{table}


\subsection{Фигуры}
В окружение \texttt{figure} можно помещать обычный \texttt{includegraphics}, таблицы, элементы \texttt{tikz}, создавать массивы изображений и т.д.

\paragraph{Пример массива изображений.}
Подписи не обязательны. Нумерацию \\ \texttt{subfloat}'ов можно выключить в \texttt{captionsetup}. Там же находится набор других настроек внешнего вида подписей.

Расстояние между картинками задается стандартными макросами шага: \texttt{quad, qquad} и т.д.

Если картинки нет, но необходимо уже сейчас отрегулировать внешний вид и размер, то можно использовать стандартные \texttt{example-image-[a,b,c]}.

\begin{figure}[H]
    \centering
    \captionsetup[subfigure]{justification=centering}
    \subfloat[Пример]{\includegraphics[height=0.1\textwidth]{example-image-a}}%
    \quad
    \subfloat[Пример]{\includegraphics[height=0.15\textwidth]{example-image-b}}%
    \quad
    \subfloat[Пример]{\includegraphics[height=0.1\textwidth]{example-image-c}}%
    \quad
    \subfloat[Очень длинная подпись, которая перенесется на новую строку]{\includegraphics[height=0.15\textwidth]{example-image-a}}%
    \caption{Общая подпись к фигуре}
\end{figure}

\subsection{Загрузка и обработка CSV файлов, построение графиков Tikz}
\newcommand{\timechart}[3]
{
	\begin{figure}[H]
		\centering
		\begin{tikzpicture}[rotate=90]
		\begin{axis}
		[			xlabel             = {Размер блока},
					ylabel             = {Время, \SI{}{\milli\second}},
					width              = 0.78\textheight,
					height             = 0.9\textwidth,
					% legend pos       = outer north east,
					legend style       = {at = {(0.5, 0.95)}, anchor = north},
					ymode              = log,
					log ticks with fixed point,
					scaled y ticks     = false,
					y tick label style = {/pgf/number format/fixed,
						/pgf/number format/1000 sep = \thinspace},
					y label style      = {at = {(axis description cs: -0.09, 0.5)}, anchor = south}
		]
		
		\addplot table [x=blockSize, y=time, col sep=comma] {\datapath/#1_#2_omp_outer.csv};
		\addlegendentry{Внешний \texttt{OpenMP}}
		
		\addplot +[restrict x to domain=6:960] table [x=blockSize, y=time, col sep=comma] {\datapath/#1_#2_omp_inner.csv};
		\addlegendentry{Внутренний \texttt{OpenMP}}
		
		\addplot table [x=blockSize, y=time, col sep=comma] {\datapath/#1_#2_future.csv};
		\addlegendentry{\texttt{std::future}}
		
		\addplot table [x=blockSize, y=time, col sep=comma] {\datapath/#1_#2_seq.csv};
		\addlegendentry{Последовательный}
		\end{axis}
		\end{tikzpicture}
		\caption{#3, тип \texttt{#2}}
	\end{figure}
}

\newcommand{\timetable}[2]
{
	\DTLloaddb{data_#1}{\datapath/#1}
	\begin{table}[H]
		\setlength{\columnsep}{1.5cm}
		\setlength{\columnseprule}{0.2pt}
		\begin{multicols}{3}
			\begin{itemize}[noitemsep]
				\DTLforeach{data_#1}{\a=blockSize,\b=time}{\item [\a] -- \b\, \SI{}{\milli\second}}
			\end{itemize}
		\end{multicols}
		\caption{#2}
	\end{table}
}

Существует множество пакетов для загрузки данных из CSV, причем все они обладают различной функциональностью и капризностью (некоторые отказываются работать в одних окружениях, другие -- в других и т.п.). Поэтому если что-то не будет работать как нужно, возможно, потребуется использовать другой пакет.

Команды для построения удобно обернуть в макросы, если планируется многократное (больше двух) использование.
\timetable{gcc_int_seq.csv}{Время работы \texttt{GCC}, последовательный, тип \texttt{int}}

\timechart{gcc}{int}{\texttt{GCC}}